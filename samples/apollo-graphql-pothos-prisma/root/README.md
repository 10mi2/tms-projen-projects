# Ten Mile Square Technologies Apollo GraphQL Server Sample Project

Source: https://github.com/10mi2/tms-projen-projects

## Description

The sample code for this project is a best-practices example of how to
set up the following stack:

- [Apollo Server](https://www.apollographql.com/docs/apollo-server/)
- [Pothos GraphQL](https://pothos-graphql.dev) Code-First Schema Generator
- [Prisma](https://www.prisma.io) Database ORM (configured for SQLite by default)
- Complete unit-test suite using [Jest](https://jestjs.io)
- Uses sortable pagination according to the blog post Proper Pagination with GraphQL (link pending)
- Uses unique IDs for every entity, always exposed as a string-encoded GraphQL `ID` type
  - The value is a Base64-encoded JSON object with enough info to uniquely identify the entity type and the entity itself

## Usage

This is a `projen`-managed project. To make changes to files marked as managed
by `projen`, you should edit the `.projenrc.ts` file and then run `npx projen`
to apply the changes.

## Code Layout

The top-level of the project is for configuratin and such, and it mostly files managed by `projen` such as `package.json` and `tsconfig.json`.

- **`./src/`** - the main source code for the project
  - **`./src/generated/`** - generated code that should still be checked in and committed to git
  - **`./src/utils/`** - utility code that is used throughout the project
- **`./prisma/`** - the Prisma schema and migrations
- **`./tests/`** - the tests for the project
  - **`./tests/util`** - utility code for the tests, such as common mocks and test data
  - **`./tests/gql/`** - autogenerated GraphQL typings made by codegen, which should still be checked in and committed to git
  - **`./test/*.test.ts`** - the tests themselves

## Initial Setup

To build all generated code (Prisma Client with Potho extensions, typings for 
GrpahQl queries in the tests, etc.), run the following command:

```bash
npm projen compile
```

This is a `prisma` project so you'll need to follow the [Prisma Documentation](https://www.prisma.io/docs/orm/prisma-migrate/getting-started)
on how to set up your database. For the initial setup of the sample code:

```bash
npx prisma migrate dev --name init
```

This will create the initial migration and apply it to your database, which is a
SQLite database which is limited compared to PostgreSQL but requires no server
so is a quick way to get up and running.

## Running the Server

To run the server, use the following command:

```bash
npm run start
```

Or, to have the server restart when you make changes to the code, use:
  
```bash 
npm run start:dev
```

In both cases, it'll provide instructions on how to access the server.

## Running the Tests

To run the tests, use the following command:

```bash
npm run test
```

If you're working on the tests and modifying the graphql queries or the schemas, you can have codgen rebuild the typings whenever a test file changes:
  
```bash
npm run codegen:watch
```